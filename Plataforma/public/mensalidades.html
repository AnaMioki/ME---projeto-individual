<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style/mensalidades.css">
    <link rel="stylesheet" href="./style/menuLateral.css">
    <script src="mensalidade.js"></script>
    <title>Scout Ease</title>
</head>

<body>
    <section class="pagina">
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <img src="./assets/logo.png" alt="Logo Scout Ease" class="logo-img">
                <!-- <span class="logo-text">SCOUT EASE</span> -->
            </div>

            <button class="toggle-btn" onclick="alternarMenu()">
                <img src="./assets/iconMenu.png" alt="" width="30px">
                <span class="label">Menu</span>
            </button>

            <ul class="menu-opcoes">
                <li>
                    <img src="./assets/iconHome.png" alt="" width="30px">
                    <a href="./home.html"><span class="label">Inicio | Dashboards</span></a>
                </li>
                <li>
                    <img src="./assets/iconEscoteiro.png" alt="" width="30px">
                    <a href=""><span class="label">Mensalidades</span></a>
                </li>
                <li>
                    <img src="./assets/iconConfig.png" alt="" width="30px">
                    <a href="./index.html"><span class="label">Configurações</span></a>
                </li>
            </ul>

            <div class="botao-sair">
                <img src="./assets/iconSair.png" alt="" width="30px">
                <a href="./index.html"><span class="label">Sair</span></a>
            </div>
        </div>

    </section>
    <section class="EscoteirosMensalidades">
        <div class="boasVindas">
            <p>Boas-Vindas, fulano </p>
            <img src="./assets/iconUser.png" alt="">
        </div>
        <h1>Escoteiros e Mensalidades</h1>
        <div class="funcionalidades">
            <div class="botoesGestao">
                <a href="./adicionarEscoteiro.html">
                    <button class="botaoEscoteiro"><img src="./assets/iconAdd.png" alt="" width="20px"
                            height="20px">Adicionar Escoteiro</button>
                </a>

                <button class="botaoMensalidade"><img src="./assets/iconDindin.png" alt="" width="20px">Lançar
                    Mensalidade</button>
            </div>

            <div class="pesquisa">
                <label>Buscar Escoteiro</label>
                <div class="inputBusca">
                    <input type="text" id="input_escoteiro" placeholder="Digite por nome ou registro">
                    <img src="./assets/iconBuscar.png" alt="" width="20px" id="btn-buscar">

                </div>
            </div>

            <div class="filtroDiv">
                <span>Filtrar</span>
                <img src="./assets/iconFiltrar.png" alt="" width="20px" id="filtrar-btn" class="filtrar-btn">
                <select id="filtro" class="filtro" style="display: none;">
                    <option value="opcao1">Opção 1</option>
                    <option value="opcao2">Opção 2</option>
                    <option value="opcao3">Opção 3</option>
                </select>
            </div>
        </div>

        <div class="listaEscoteiros" id="listaEscoteiros">
            <span>Painel Escoteiro | Controle de Mensalidades e Dados Pessoais</span>
            <div class="escoteiro" id="moldeEscoteiro" style="display: none;">
                <div class="info">
                    <div class="dados">
                        <div class="identificacao">
                            <span class="registro"></span>
                            <span class="nome"></span>
                            <img src="./assets/iconEditar.png" alt="editar" class="editar-btn"
                                onclick="editarEscoteiro()">

                        </div>
                        <div class="mensalidadeInfo">
                            <span class="secao"></span>
                            <div class="vencimento">
                                <span class="status"></span>
                                <span class="vencimento"></span>
                            </div>
                        </div>

                    </div>
                    <div class="botoes">
                        <button class="btn-darBaixa" style="display:none">Dar Baixa</button>
                        <button class="btn-verMensalidades" onclick="mostrarDetalhes('${escoteiro.registro}')">Ver
                            Mensalidades</button>
                        <img src="./assets/iconExcluir.png" alt="" class="excluir-btn" width="20px"
                            onclick="excluirEscoteiro('${escoteiro.registro}')">
                    </div>
                </div>
            </div>
        </div>
        </div>

        <div id="mensagem" style="display: none;">
            Adicione um escoteiro
        </div>
    </section>
</body>

</html>



<script>
    function alternarMenu() {
        const barraLateral = document.getElementById("sidebar");
        barraLateral.classList.toggle("expandido");
    }


    document.getElementById('filtrar-btn').addEventListener('click', function () {
        var filtro = document.getElementById('filtro');
        // Alterna entre mostrar e esconder o select
        if (filtro.style.display === 'none' || filtro.style.display === '') {
            filtro.style.display = 'block';
        } else {
            filtro.style.display = 'none';
        }
    });

    const escoteirosTeste = [
        { registroEscoteiro: "001", nome: "Ana", secaoRamo: "Lobinho", nomeResponsavel: "Carlos", celular: "99999-9999", statusMensalidade: "atrasado" },
        { registroEscoteiro: "002", nome: "Bruno", secaoRamo: "Escoteiro", nomeResponsavel: "Maria", celular: "98888-8888", statusMensalidade: "em dia" },
    ];
    // const fkUsuario = sessionStorage.ID_USUARIO;
    window.onload = () => {
        

        if (!fkUsuario) {
            alert("Usuário não logado.");
            return;
        }

        renderizarEscoteiros(escoteirosTeste);
    }

    // fetch(`/escoteiro/mensalidades/${fkUsuario}`)
    //     .then(res => {
    //         if (!res.ok) throw new Error("Erro ao buscar escoteiros.");
    //         return res.json();
    //     })
    //     .then(dados => {
    //         if (dados.length === 0) {
    //             document.getElementById("mensagem").style.display = "block";
    //             document.getElementById("listaEscoteiros").style.display = "none";
    //         } else {
    //             renderizarEscoteiros(dados);
    //         }
    //     })
    //     .catch(erro => {
    //         console.error("Erro:", erro);
    //         alert("Não foi possível carregar os escoteiros.");
    //     });


    function renderizarEscoteiros(escoteiros) {
        const lista = document.getElementById("listaEscoteiros");
        const molde = document.getElementById("moldeEscoteiro");

        lista.innerHTML = "";
        // lista.forEach(e => e.remove()); // limpa os antigos

        escoteirosTeste.forEach(escoteiro => {
            const clone = molde.cloneNode(true);
            // clone.id = ""; // remove o id para evitar duplicidade
            clone.style.display = "block";

            clone.querySelector(".registro").textContent = escoteiro.registroEscoteiro;
            clone.querySelector(".nome").textContent = escoteiro.nome;
            clone.querySelector(".secao").textContent = escoteiro.secaoRamo || "Não informado";
            clone.querySelector(".status").textContent = escoteiro.statusMensalidade || "Desconhecido";
            clone.querySelector(".vencimento").textContent = escoteiro.vencimentoMensalidade || "";

            // Botão Dar Baixa só aparece se status for 'atrasado'
            const btnDarBaixa = clone.querySelector(".btn-darBaixa");
            if (escoteiro.statusMensalidade === "atrasado") {
                btnDarBaixa.style.display = "inline-block";
                btnDarBaixa.onclick = () => darBaixa(escoteiro.registroEscoteiro);
            } else {
                btnDarBaixa.style.display = "none";
            }

            // Outros botões (excluir, ver mensalidades) podem ter evento aqui também
            // clone.querySelector(".excluir-btn").onclick = () => excluirEscoteiro(escoteiro.registroEscoteiro);
            // clone.querySelector(".btn-verMensalidades").onclick = () => mostrarDetalhes(escoteiro.registroEscoteiro);

            lista.appendChild(clone);
        });
    }

    function darBaixa(registro) {
        alert(`Dar baixa na mensalidade do escoteiro ${registro}`);
        // Aqui você pode fazer uma chamada API para atualizar o status no banco
    }


    document.getElementById('btn-buscar').addEventListener('click', function () {
        var input = document.getElementById('input_escoteiro').value;
        if (input.trim() !== '') {
            // Aqui você pode realizar a ação de busca, como enviar uma solicitação para um banco de dados ou apenas mostrar uma mensagem
            alert('Buscando por: ' + input); // Exemplo de ação
        } else {
            alert('Por favor, digite um nome ou registro para buscar.');
        }
    });


</script>